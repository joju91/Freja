<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini GeoGuessr</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    /* Grundinst√§llningar */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Montserrat', sans-serif; height:100vh; overflow:hidden; }
    /* Startsk√§rm */
    .start-screen { position:fixed; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg,#667eea,#764ba2); display:flex; align-items:center; justify-content:center; z-index:1000;}
    .start-content { position:relative; z-index:10; text-align:center; color:#fff; max-width:500px; padding:2rem;}
    .start-content h1 { font-size:2.5rem; margin-bottom:1rem; text-shadow:2px2px4px rgba(0,0,0,0.5);}
    .start-content p { font-size:1.1rem; margin-bottom:2rem; opacity:0.9;}
    .difficulty-section { margin-bottom:2rem; }
    .difficulty-section label { display:block; margin-bottom:0.5rem; font-weight:500; }
    .difficulty-section select { padding:0.5rem 1rem; border:none; border-radius:8px; font-size:1rem; min-width:250px; margin-bottom:1rem; }
    .difficulty-description { font-size:0.9rem; opacity:0.8; font-style:italic; min-height:40px; }
    .start-button { background:linear-gradient(45deg,#ff6b6b,#ff8e53); border:none; padding:1rem 2rem; font-size:1.1rem; color:#fff; border-radius:50px; cursor:pointer; font-weight:500; transition:all 0.3s; box-shadow:0 4px 15px rgba(0,0,0,0.2);}
    .start-button:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.3);}
    /* Spelyta */
    #gameContainer { display:none; width:100%; height:100vh; position:relative; }
    .score-bar { position:fixed; top:0; left:0; right:0; background:rgba(255,255,255,0.95); padding:1rem; display:flex; justify-content:space-between; align-items:center; z-index:500; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
    .game-layout { display:flex; height:100%; margin-top:3.5rem; }
    .map-container { flex:1; position:relative; }
    #streetMap, #guessMap { width:100%; height:100%; }
    .message-box { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%); background:white; padding:1rem 2rem; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.3); display:none; z-index:600; max-width:80%; text-align:center;}
    .message-box.clickable { cursor:pointer; background:#f0f8ff; border:2px solid #4A90E2;}
    .message-box.clickable:hover { background:#e6f3ff; }
    /* Animation */
    @keyframes fadeInUp { from { opacity:0; transform:translateY(30px);} to { opacity:1; transform:translateY(0);} }
    .fade-in { animation:fadeInUp 1s ease-out both; }
  </style>
</head>
<body>
  <div id="startScreen" class="start-screen">
    <div class="start-content fade-in">
      <h1>Mini GeoGuessr</h1>
      <p>Utforska v√§rlden, gissa platsen och utmana dig sj√§lv!</p>
      <div class="difficulty-section">
        <label for="difficulty">V√§lj sv√•righetsgrad:</label>
        <select id="difficulty">
          <option value="easy">L√§tt - Stora st√§der</option>
          <option value="medium" selected>Medel - Blandade platser</option>
          <option value="hard">Sv√•r - Slumpm√§ssiga platser</option>
        </select>
        <div id="difficultyDescription" class="difficulty-description"></div>
      </div>
      <button id="startButton" class="start-button">Starta √§ventyret</button>
    </div>
  </div>

  <div id="gameContainer">
    <div id="scoreBar" class="score-bar">
      <div id="roundInfo">Runda: 0/0</div>
      <div id="scoreInfo">Po√§ng: 0</div>
      <div id="highScoreInfo">Rekord: 0</div>
    </div>
    <div class="game-layout">
      <div class="map-container"><div id="streetMap"></div></div>
      <div class="map-container"><div id="guessMap"></div></div>
    </div>
  </div>
  <div id="messageBox" class="message-box"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Konfiguration
    const CITIES = [
      {name:"Stockholm, Sverige",lat:59.3293,lon:18.0686,region:"europe"},
      {name:"Oslo, Norge",lat:59.9139,lon:10.7522,region:"europe"},
      {name:"Visby, Sverige",lat:57.6349,lon:18.2948,region:"europe"},
      {name:"Malm√∂, Sverige",lat:55.6050,lon:13.0038,region:"europe"},
      {name:"Berlin, Tyskland",lat:52.5200,lon:13.4050,region:"europe"},
      {name:"Madrid, Spanien",lat:40.4168,lon:-3.7038,region:"europe"},
      {name:"Rom, Italien",lat:41.9028,lon:12.4964,region:"europe"},
      {name:"Paris, Frankrike",lat:48.8566,lon:2.3522,region:"europe"},
      {name:"London, Storbritannien",lat:51.5074,lon:-0.1278,region:"europe"},
      {name:"Aten, Grekland",lat:37.9838,lon:23.7275,region:"europe"},
      // ‚Ä¶ forts√§tt l√§gga till fler st√§der efter behov ‚Ä¶
    ];
    const TOTAL_ROUNDS = 5;
    const feedbackOptions = {
      close: ["üéØ Perfekt tr√§ff!","üåü Imponerande n√§ra!","‚úÖ Du prickade in det!","üëè Toppenjobbat!","üèÜ Du √§r en m√§stare p√• kartor!","üî• Otroligt n√§ra!","‚ú® N√§stan oslagbart!","ü•á Du tog guldet!","üí• Fantastisk precision!","üéâ Vilket tr√§ffs√§kerhet!"],
      good: ["üëç Bra gissat!","üòä Fin insats!","üëç Du √§r p√• r√§tt sp√•r!","üåà Bra f√∂rs√∂k!","üëè Du kommer n√§rmare!","üôÇ Bra jobbat!","üòé Ganska n√§ra!","üí™ Starkt gjort!","üèÖ Du n√•r pallen snart!","üòÉ Str√•lande f√∂rs√∂k!"],
      meh: ["üëå Inte illa, men lite l√§ngre bort!","üòâ Du kom ganska n√§ra!","ü§î N√§sta g√•ng n√•r du fram!","üôÇ Helt okej, men kan bli b√§ttre!","üòå Du √§r p√• g√•ng!","üîç Du s√∂ker r√§tt omr√•de!","üëç Forts√§tt √∂va, du kommer dit!","üòÖ Inte direkt p√• pricken!","üöÄ N√§sta g√•ng skjuter du iv√§g!","üéà Du var p√• v√§g!"],
      far: ["ü§î Oj, l√•ngt ifr√•n den h√§r g√•ngen!","üòÖ Det var en riktig l√•ngresa!","üî≠ N√§sta g√•ng ser du landet tydligare!","üåç Du hamnade i fel del av v√§rlden!","üòÆ Hoppsan, det blev ett √§ventyr!","üß≠ N√§sta g√•ng hittar du r√§tt riktning!","üö∂ Du fick promenera en bit!","üê¢ Ta sats ‚Äì du n√•r fram!","üéí Packa ner mer information till n√§sta gissning!","‚è≥ Det tog ett tag, men du l√§r dig!"]
    };

    // State
    let difficulty = 'medium', currentRound=0, score=0, highScore= parseInt(localStorage.getItem('geoguessrHighScore')||'0');
    let streetMap, guessMap, guessMarker, actualMarker, lineMarker, currentLocation;

    // DOM
    const startScreen=document.getElementById('startScreen'),
          gameContainer=document.getElementById('gameContainer'),
          startButton=document.getElementById('startButton'),
          difficultySelect=document.getElementById('difficulty'),
          difficultyDesc=document.getElementById('difficultyDescription'),
          roundInfo=document.getElementById('roundInfo'),
          scoreInfo=document.getElementById('scoreInfo'),
          highScoreInfo=document.getElementById('highScoreInfo'),
          messageBox=document.getElementById('messageBox');

    // Beskrivningar
    const descriptions={
      easy:"Endast stora, v√§lk√§nda st√§der!",
      medium:"Blandade st√§der f√∂r lagom utmaning.",
      hard:"Helt slumpade platser √∂ver hela v√§rlden!"
    };

    // Init
    difficultyDesc.textContent=descriptions[difficulty];
    difficultySelect.onchange=()=>{
      difficulty=difficultySelect.value;
      difficultyDesc.textContent=descriptions[difficulty];
    };
    startButton.onclick=startGame;

    function startGame(){
      startScreen.style.display='none';
      gameContainer.style.display='block';
      currentRound=0; score=0;
      updateHighScore();
      initMaps();
      nextRound();
    }

    function initMaps(){
      const opts={scrollWheelZoom:false,doubleClickZoom:false,minZoom:2,maxZoom:15};
      streetMap=L.map('streetMap',opts).setView([59.3293,18.0686],5);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(streetMap);
      guessMap=L.map('guessMap',{scrollWheelZoom:true,zoomControl:true,minZoom:2,maxZoom:5}).setView([20,0],2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap contributors'}).addTo(guessMap);
      guessMap.on('click',e=>{ if(!guessMarker) makeGuess(e.latlng); });
    }

    function nextRound(){
      if(currentRound>=TOTAL_ROUNDS){ endGame(); return; }
      currentRound++; clearMarkers();
      currentLocation=pickLocation();
      streetMap.setView([currentLocation.lat,currentLocation.lon],getZoom());
      roundInfo.textContent=`Runda: ${currentRound}/${TOTAL_ROUNDS}`;
      scoreInfo.textContent=`Po√§ng: ${score}`;
      showMessage(`Runda ${currentRound}: Var ligger ${currentLocation.name}?`);
    }

    function pickLocation(){
      const pool=CITIES.filter(c=>c.region==='europe' || difficulty!=='easy');
      return pool[Math.floor(Math.random()*pool.length)];
    }

    function getZoom(){
      return difficulty==='easy'?8:difficulty==='medium'?6:4;
    }

    function makeGuess({lat,lng}){
      guessMarker=L.marker([lat,lng]).addTo(guessMap);
      actualMarker=L.marker([currentLocation.lat,currentLocation.lon]).addTo(guessMap);
      lineMarker=L.polyline([[lat,lng],[currentLocation.lat,currentLocation.lon]],{color:'blue'}).addTo(guessMap);
      const dist=calculateDistance(lat,lng,currentLocation.lat,currentLocation.lon);
      const pts=Math.max(0,1000-Math.round(dist));
      score+=pts; scoreInfo.textContent=`Po√§ng: ${score}`;
      saveHighScore();
      const category=dist<50?'close':dist<200?'good':dist<500?'meh':'far';
      const opts=feedbackOptions[category];
      const feedback=opts[Math.floor(Math.random()*opts.length)];
      showMessage(`${Math.round(dist)} km ‚Äì ${feedback}`,true,nextRound);
    }

    function calculateDistance(la,lo,la2,lo2){
      const R=6371,dLat=(la2-la)*Math.PI/180,dLon=(lo2-lo)*Math.PI/180;
      const a=Math.sin(dLat/2)**2+Math.cos(la*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLon/2)**2;
      return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    }

    function clearMarkers(){
      [guessMarker,actualMarker,lineMarker].forEach(m=>{if(m)guessMap.removeLayer(m)});
      guessMarker=actualMarker=lineMarker=null;
    }

    function updateHighScore(){
      if(score>highScore){highScore=score;localStorage.setItem('geoguessrHighScore',highScore);}
      highScoreInfo.textContent=`Rekord: ${highScore}`;
    }

    function showMessage(txt,clickable=false,cb=null){
      messageBox.textContent=txt; messageBox.style.display='block';
      if(clickable){ messageBox.classList.add('clickable'); messageBox.onclick=()=>{
        messageBox.style.display='none'; messageBox.classList.remove('clickable');
        messageBox.onclick=null; cb(); };
      } else setTimeout(()=>messageBox.style.display='none',3000);
    }

    function endGame(){
      showMessage(`Spelet slut! Din po√§ng: ${score}`,true,()=>{
        gameContainer.style.display='none';
        startScreen.style.display='flex';
      });
    }
  </script>
</body>
</html>
